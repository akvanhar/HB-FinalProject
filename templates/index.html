{% extends 'base.html' %}
{% block content %}
<!-- facebook initialization -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=478449745662319";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

	function logout() {
		console.log('hey! Logout!')
		FB.logout(function(response) {
  			// user is now logged out
  			console.log(response)
  			var form = document.createElement('form');

  			form.method = "POST";
    		form.action = "/fblogout_portal";

    		document.body.appendChild(form);

      		form.submit();
		});
	}
	// figure out how to run the logout function on clicking the logout button
</script>
<!-- end facebook magic -->

<div class="fb-login-button" data-max-rows="1" data-size="medium" data-show-faces="false" data-auto-logout-link="true" scope='public_profile,email,user_friends'></div>

<h1>Make Less Mush</h1>

{% for message in get_flashed_messages() %}
	{{message}}
{% endfor %}

<h2>Post a new listing</h2>
	<form action='/postlisting' method='post'>
		<label>Title:
			<input type='text' name='title'>
		</label>
		<br>
		<label>Description:<br>
			<textarea name='description' rows='10' cols='50' placeholder='Please include: ingredients, texture, quantity and when it was made.'></textarea>
		</label>
		<br>
		<input type='submit' value='create listing'>
	</form>

<h2>Most recent listings:</h2>

<table>
	<thead>
		<tr>
			<th>Date posted</th>
			<th>Title</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody>
		{% for food in recent_listings %}
			<tr>
				<td>{{ food.post_date.strftime("%b %d, %Y") }}</td>
				<td><a href="/listings/{{ food.food_id }}">
                    {{ food.title }}
                	</a>
                </td>
				<td>{{ food.description }}</td>
			</tr>
		{% endfor %}
	</tbody>
</table>



<p><a href='/listings'>View all</a></p>

{% endblock %}
